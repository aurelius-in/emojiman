<!DOCTYPE html>
<html>
<head>
  <title>Pac-Man</title>
  <style>
    canvas {
      border: 0px;
      background-color: black;
      margin-left: 20px;
    }
    body {
      margin: 0;
      padding: 0;
      touch-action: manipulation;
      background-color: black;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="840" height="1312"></canvas>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  let pacmanX = canvas.width / 2;
  let pacmanY = canvas.height / 2;
  let pacmanRadius = 21; // 5% bigger
  let pacmanSpeed = 3.15; // 5% faster
  let angle = 0;
  let direction = 'right';
  let touchStartX = 0;
  let touchStartY = 0;
  let mouthSpeed = 0.05;
  let mouthAngle = 0;

  const cellSize = 52.5; // 5% bigger

  const maze = [
    '111111111111111',
    '100000000000001',
    '101110111011101',
    '100000000000001',
    '111011121110111',
    '000010000010000',
    '111011111110111',
    '100000000000001',
    '101110111011101',
    '100000000000001',
    '111111101111111',
    '100000000000001',
    '101111000111101',
    '100000000000001',
    '111111101111111',
    '100000000000001',
    '101110111011101',
    '100000000000001',
    '111011111110111',
    '000010000010000',
    '111011121110111',
    '100000000000001',
    '101110111011101',
    '100000000000001',
    '111111111111111'
  ];

  canvas.addEventListener('touchstart', function(e) {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  });

  canvas.addEventListener('touchmove', function(e) {
    e.preventDefault();
    const touchEndX = e.touches[0].clientX;
    const touchEndY = e.touches[0].clientY;
    const dx = touchEndX - touchStartX;
    const dy = touchEndY - touchStartY;

    if (Math.abs(dx) > Math.abs(dy)) {
      direction = dx > 0 ? 'right' : 'left';
    } else {
      direction = dy > 0 ? 'down' : 'up';
    }
  });

  function checkCollision(x, y) {
    const gridX = Math.floor((x - 21) / cellSize);
    const gridY = Math.floor((y - 21) / cellSize);
    return maze[gridY][gridX] === '1' || maze[gridY][gridX] === '2';
  }

  function drawMaze() {
    for (let y = 0; y < maze.length; y++) {
      for (let x = 0; x < maze[y].length; x++) {
        if (maze[y][x] === '1') {
          ctx.fillStyle = '#0000FF';
          ctx.fillRect(x * cellSize + 21, y * cellSize + 21, cellSize, cellSize);
        } else if (maze[y][x] === '2') {
          ctx.fillStyle = '#808080';
          ctx.fillRect(x * cellSize + 21, y * cellSize + 21, cellSize, cellSize);
        }
      }
    }
  }

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw walls
    drawMaze();

    // Set angle based on direction
    if (direction === 'up') angle = -Math.PI / 2;
    if (direction === 'down') angle = Math.PI / 2;
    if (direction === 'left') angle = Math.PI;
    if (direction === 'right') angle = 0;

    // Draw Pac-Man
    ctx.fillStyle = '#FFFF00';
    ctx.beginPath();
    ctx.moveTo(pacmanX, pacmanY);
    ctx.arc(pacmanX, pacmanY, pacmanRadius, angle + mouthAngle, angle + Math.PI * 2 - mouthAngle);
    ctx.lineTo(pacmanX, pacmanY);
    ctx.fill();

    let nextX = pacmanX;
    let nextY = pacmanY;

    if (direction === 'up') nextY -= pacmanSpeed;
    if (direction === 'down') nextY += pacmanSpeed;
    if (direction === 'left') nextX -= pacmanSpeed;
    if (direction === 'right') nextX += pacmanSpeed;

    if (!checkCollision(nextX, nextY)) {
      pacmanX = nextX;
      pacmanY = nextY;
    }

    mouthAngle += mouthSpeed;
    if (mouthAngle > Math.PI / 4 || mouthAngle < 0) {
      mouthSpeed = -mouthSpeed;
    }

    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>
</body>
</html>
